#!/bin/bash

source environment.conf

rm -rf $results_path

mkdir code
mkdir results

if [ ! -d $code_path/$promethee_path ]; then
	git clone $promethee_url
	mv $promethee_path $code_path

	cd $code_path/$promethee_path
	git checkout --detach $promethee_version
	cd -
fi

if [ ! -d $code_path/$tiff_utils_path ]; then
	git clone $tiff_utils_url
	mv $tiff_utils_path $code_path

	cd $code_path/$tiff_utils_path
	git checkout --detach $tiff_utils_version
	cd -
fi

if [ ! -e $code_path/$umbu_caja_path/$tiff_name ]; then
	cd $code_path/$tiff_utils_path
	g++ -std=c++14 tifGenerator.cpp -o tifGenerator -ltiff
	./tifGenerator 4000 $tiff_name -R
	rm tifGenerator	
	cd -
	mv $code_path/$tiff_utils_path/$tiff_name $code_path/$umbu_caja_path
fi

echo $tiff_name 1 1 > $code_path/$umbu_caja_path/criteria

cd $code_path/$umbu_caja_path

g++ -std=c++14 umbu.cpp -o umbu -ltiff
g++ -std=c++14 merge.cpp -o merge -ltiff

cd -